<!doctype html>
<html lang="en">
<meta charset="utf-8">
<title>.ms</title>
<style>button {font-size: 12px; width: 20px; height: 20px; padding: 0px; }</style>
<script>
	/*
	
		NEXT TO-DOS:
	-	Add initial form to choose height, lenght & amount of mines
	-	Edit rightClick function to differentiate clicks in unclicked buttons and flags from clicks in sums,
		then open surrounding blocks if the amount of flags around the clicked block equals its sum.
	
	*/

	let height = 22, lenght = 44, mines = 222, blocks = [];

	window.onload = () => start();

	function start() {
		for (let i = 0; i < height; i++) {
			let row = [];
			for (let j = 0; j < lenght; j++) row.push({ mine: false, sum: 0 });
			blocks.push(row);
		}
		
		while (mines) {
			let i = Math.floor(Math.random() * height);
			let j = Math.floor(Math.random() * lenght);

			if (!blocks[i][j].mine) {
				blocks[i][j].mine = true;
				mines--;
			}
		}
		
		let table = document.createElement('table');
		table.style = 'margin: auto;';

		for (let i = 0; i < height; i++) {
			let tr = document.createElement('tr');
			table.appendChild(tr);

			for (let j = 0; j < lenght; j++) {
				for (let ii = -1; ii < 2; ii++) {
					for (let jj = -1; jj < 2; jj++) {
						if (i + ii >= 0 &&
							j + jj >= 0 &&
							i + ii < height &&
							j + jj < lenght &&
							(ii !== 0 || jj !== 0) &&
							blocks[i + ii][j + jj].mine
						) blocks[i][j].sum++;
					}
				}
				
				let td = document.createElement('td');
				tr.appendChild(td);
				
				blocks[i][j]['button'] = document.createElement('button');
				blocks[i][j].button.textContent = '\u00A0';
				blocks[i][j].button.onclick = () => leftClick(i, j);
				blocks[i][j].button.oncontextmenu = () => {
					rightClick(i, j);
					return false;
				}

				td.appendChild(blocks[i][j].button);
			}
		}

		document.body.appendChild(table);
	}

	function leftClick(i, j) {
		if (blocks[i][j].button.textContent === '\u00A0') {
			blocks[i][j].button.textContent = (blocks[i][j].mine) ? '\uD83D\uDCA3' : blocks[i][j].sum;

			if (blocks[i][j].sum === 0 && !blocks[i][j].mine) {
				for (let ii = -1; ii < 2; ii++) {
					for (let jj = -1; jj < 2; jj++) {
						if (i + ii >= 0 &&
							j + jj >= 0 &&
							i + ii < height &&
							j + jj < lenght &&
							(ii !== 0 || jj !== 0) &&
							!blocks[i + ii][j + jj].mine
						) leftClick(i + ii, j + jj);
					}
				}
			}
		}
	}

	function rightClick(i, j) {
		blocks[i][j].button.textContent = (blocks[i][j].button.textContent === '\u00A0') ? '\uD83D\uDEA9' : '\u00A0';
	}
</script>
